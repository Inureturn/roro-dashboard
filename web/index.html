<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoRo Fleet Dashboard v2.0.1</title>

  <!-- Aggressive cache prevention -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link href='https://unpkg.com/maplibre-gl@5.8.0/dist/maplibre-gl.css' rel='stylesheet' />
  <link rel="stylesheet" href="/style.css?v=2.0.1">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <h1 data-i18n="title">🚢 RoRo Fleet Dashboard</h1>
        <div class="header-stats">
          <span class="stat"><span class="stat-label" data-i18n="totalVessels">Total Vessels:</span> <span id="total-vessels">0</span></span>
          <span class="stat"><span class="stat-label" data-i18n="myFleet">My Fleet:</span> <span id="my-fleet-count">0</span></span>
          <span class="stat"><span class="stat-label" data-i18n="active">Active:</span> <span id="active-vessels">0</span></span>
          <span class="stat"><span class="stat-label" data-i18n="lastUpdate">Last Update:</span> <span id="last-update" data-i18n="never">Never</span></span>

          <div class="header-controls">
            <button class="icon-btn" id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">🌙</button>
            <button class="icon-btn" id="lang-toggle" aria-label="Switch language" title="Switch language">🌐</button>
            <button class="info-btn" id="system-info-btn" data-i18n-title="systemInfoButton" title="System Info">ℹ️</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Demo Data Warning Banner (hidden by default, shown when using pulled data) -->
    <div id="demo-data-banner" class="demo-data-banner hidden">
      ⚠️ <span id="demo-data-message">Demo data from <span id="demo-data-date"></span> - Real-time tracking coming with satellite view</span>
    </div>

    <!-- Main Content -->
    <div class="dashboard-main">
      <!-- Mobile Menu Toggles -->
      <button class="mobile-menu-toggle left-toggle" id="mobile-left-toggle" aria-label="Toggle vessel list">☰</button>
      <button class="mobile-menu-toggle right-toggle" id="mobile-right-toggle" aria-label="Toggle vessel details">ℹ️</button>

      <!-- Backdrop for mobile overlays (sidebar/details) -->
      <div id="backdrop" class="backdrop hidden" aria-hidden="true"></div>

      <!-- Vessel List Sidebar -->
      <aside class="vessel-sidebar" id="vessel-sidebar">
        <div class="sidebar-header">
          <h2 data-i18n="fleet">Fleet</h2>
          <div class="filter-tabs">
            <button class="filter-tab active" data-filter="my-fleet" data-i18n="myFleet">My Fleet</button>
            <button class="filter-tab" data-filter="tracked" data-i18n="allTracked">All Tracked</button>
          </div>
          <input type="text" id="vessel-search" placeholder="Search vessels..." data-i18n-placeholder="searchPlaceholder" class="search-input">

          <!-- Mobile-only controls: theme, language, info -->
          <div class="mobile-controls">
            <button class="icon-btn" id="theme-toggle-mobile" aria-label="Toggle theme" title="Toggle theme">🌙</button>
            <button class="icon-btn" id="lang-toggle-mobile" aria-label="Switch language" title="Switch language">🌐</button>
            <button class="info-btn" id="system-info-btn-mobile" data-i18n-title="systemInfoButton" title="System Info">ℹ️</button>
          </div>
        </div>

        <!-- Manual Data Warning Banner -->
        <div id="manual-data-warning" class="manual-data-warning hidden">
          <div class="warning-icon">⚠️</div>
          <div class="warning-content">
            <strong data-i18n="manualDataTitle">Position Data Manually Fetched</strong>
            <p data-i18n="manualDataMessage">These positions were scraped from VesselFinder and will be outdated. Real-time tracking coming with satellite view.</p>
          </div>
        </div>

        <div id="vessel-list" class="vessel-list">
          <div class="loading" data-i18n="loading">Loading vessels...</div>
        </div>
      </aside>

      <!-- Map Container -->
      <div class="map-container">
        <div id="stale-data-warning" class="stale-data-warning hidden" data-i18n="staleDataWarning">
          ⚠️ Data may be outdated. Last AIS update received more than 5 minutes ago.
        </div>
        <div id="map"></div>
        <div class="map-attribution">
          © <a href="https://www.maptiler.com/copyright/" target="_blank">MapTiler</a> © <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors
        </div>
        <!-- Toast notifications -->
        <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
      </div>

      <!-- Vessel Details Panel (Initially Hidden) -->
      <aside class="vessel-details hidden" id="vessel-details">
        <div class="details-header">
          <h2 id="details-title" data-i18n="vesselDetails">Vessel Details</h2>
          <button class="close-btn" id="close-details">&times;</button>
        </div>
        <div class="details-content" id="details-content">
          <div class="loading" data-i18n="selectVessel">Select a vessel to view details</div>
        </div>
      </aside>
    </div>

    <!-- System Info Modal -->
    <div id="system-info-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="systemInfo">System Information</h3>
          <button class="close-btn" id="close-info-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="info-section">
            <h4 data-i18n="currentStatus">📊 Current Status</h4>
            <p><strong data-i18n="fleetTracking">My Fleet Tracking:</strong> <span data-i18n="fleetTrackingValue">Manual (VesselFinder)</span></p>
            <p><strong data-i18n="competitorTracking">Competitor Tracking:</strong> <span data-i18n="competitorTrackingValue">Real-time AIS</span></p>
            <p><strong data-i18n="dataSource">Data Source:</strong> <span data-i18n="dataSourceValue">AISHub + Manual Fetch</span></p>
            <p><strong data-i18n="updateFrequency">Update Frequency:</strong> <span data-i18n="updateFrequencyValue">30 seconds (live)</span></p>
          </div>

          <div class="info-section">
            <h4 data-i18n="knownLimitations">⚠️ Known Limitations</h4>
            <p><strong data-i18n="myFleetPositions">My Fleet Positions:</strong> <span data-i18n="myFleetPositionsValue">Manually scraped, may be outdated</span></p>
            <p><strong data-i18n="aisGaps">AIS Coverage:</strong> <span data-i18n="aisGapsValue">Some vessels don't transmit AIS</span></p>
            <p><strong data-i18n="positionAge">Position Age:</strong> <span data-i18n="positionAgeValue">Check "Last seen" timestamps</span></p>
          </div>

          <div class="info-section">
            <h4 data-i18n="upcomingFeatures">🚀 Roadmap</h4>
            <p><strong data-i18n="satelliteView">Satellite Tracking:</strong> <span data-i18n="satelliteViewValue">Real-time fleet positions via satellite</span></p>
            <p><strong data-i18n="routePrediction">Route Prediction:</strong> <span data-i18n="routePredictionValue">AI-powered ETA calculations</span></p>
            <p><strong data-i18n="weatherOverlay">Weather Integration:</strong> <span data-i18n="weatherOverlayValue">Live weather overlays on map</span></p>
            <p><strong data-i18n="alerts">Custom Alerts:</strong> <span data-i18n="alertsValue">Notifications for arrival/departure</span></p>
          </div>

          <div class="info-section">
            <h4 data-i18n="technicalDetails">🔧 Technical Details</h4>
            <p><strong data-i18n="mapProvider">Map Provider:</strong> <span data-i18n="mapProviderValue">MapTiler (100K loads/month free)</span></p>
            <p><strong data-i18n="database">Database:</strong> <span data-i18n="databaseValue">Supabase PostgreSQL</span></p>
            <p><strong data-i18n="dataRetention">Data Retention:</strong> <span data-i18n="dataRetentionValue">90 days of position history</span></p>
            <p><strong data-i18n="refreshRate">Auto Refresh:</strong> <span data-i18n="refreshRateValue">Every 30 seconds</span></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/main.js?v=2.0.1"></script>
</body>
</html>
